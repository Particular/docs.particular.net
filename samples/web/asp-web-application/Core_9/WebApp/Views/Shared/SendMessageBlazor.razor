@using Microsoft.Extensions.Logging
@inject ILogger<SendMessageBlazor> Logger;
#region MessageSessionInjectionBlazor
@inject IMessageSession MessageSession;
#endregion
<PageTitle>NServiceBus Blazor server</PageTitle>

<div>
    Enter a number below and click "Go".<br />
    If the number is even, the result will be "Fail", otherwise it will be "None".
    <br /><br />
    <input type="text" @bind="_userInput" />
    <input type="submit" value="Go" @onclick="HandleValidSubmit" />
    <br />
    @_responseText
    <br />
</div>

@code {
    private string? _userInput;
    private string? _responseText;

    protected async Task HandleValidSubmit()
    {
        Logger.LogInformation("HandleValidSubmit called");

        // Process the valid form
        if (string.IsNullOrWhiteSpace(_userInput))
        {
            await Task.CompletedTask;
        }

        #region BlazorSendMessage

        if (!int.TryParse(_userInput, out var number))
        {
            return;
        }
        var command = new Command
        {
            Id = number
        };

        var code = await MessageSession.Request<ErrorCodes>(command);
        _responseText = Enum.GetName(code);

        #endregion
    }
}
